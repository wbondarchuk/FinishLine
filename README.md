# Theia application server

Этот скрипт предназначен для запуска сред разработки, основанных на [Theia](https://theia-ide.org/), как application-as-a-service. В теории, должно работать с произвольным приложем, упакованным в докер-контейнер, и публикующим единственный порт.

Принцип работы состоит в том, что на каждое входящее соединение создаётся и запускается новый контейнер, а клиент перенаправляется на него. Фоновый процесс регулярно проверяет логи контейнеров, и если видит, что клиент покинул контейнер (закрыл вкладку), то контейнер удаляется.

***Контейнеры удаляются полностью***, не оставляя на сервере пользовательских данных. Поэтому пользователи должны самостоятельно скачивать результаты своей работы прежде, чем закрывать вкладку.

# Необходимое ПО

- Python 3 (конкретные модули перечислю позже)
- [Docker](https://docs.docker.com/engine/install/)

# Настройка

Файл [config.ini](https://github.com/Goilee/RIDE-server/blob/4a31a5c23972b775c0237a7334b9b3bdfded33a8/config.ini) содержит параметры сервера.

### Network

- **Host** - IP адрес, на котором будет запущен сервер и все созданные контейнеры.
- **Port** - порт, который слушает запущенный сервер.

### Docker

- **Image** - название докер-образа, из которого создаются контейнеры. Образ должен быть скачан, либо доступен в публичных докер-репозиториях.
- **Exposed_port** - порт, который в докерфайле указан в команде EXPOSE
- **New_client_output_substr** - Подстрока, наличие которой в логах контейнера говорит о подключении нового пользователи. Этот параметр нужно менять только если используется не Тея.
- **Client_exited_output_substr** - Подстрока, наличие которой в логах контейнера говорит об отключении пользователи. Этот параметр нужно менять только если используется не Тея.

### CLEANER

- **Time_interval_in_seconds** - интервал в секундах между проверками наличия клиентов у контейнеров и удалением ненужных.

# Запуск

Сервер запускается командой

    sudo python3 server.py
    
Опция --debug запускает сервер в отладочном режиме. Рекомендуется использоваться при тестировании, но не в релизе, поскольку с этой опцией в случае необработанного исключения клиенты увидят его подробности.

# Ограничения

1. При отключении пользователи контейнер полностью удаляется. Никакие данные на сервере не хранятся, и клиент должен самостоятельно загрузить результаты своей работы перед выходом.
2. Подразумевается, что с каждым контейнером работает единственный пользователь. Если одним контейнером пользуется несколько клиентов, то будет некорректно работать логика закрытия контейнеров.
3. Если пользователь поделится с кем-то содерджимым адресной строки во время работы с контейнером, то даст полный доступ к этому контейнеру и его данным.
